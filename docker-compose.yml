# docker-compose.yml
# 使用前请确保 .env 文件存在并包含 BACKEND_IMAGE 和 FRONTEND_IMAGE

services:
  backend:
    image: ${BACKEND_IMAGE}
    container_name: anyqa_backend
    env_file:
      - .env
    ports:
      - "18082:8080"
    restart: always
    environment:
      - DB_USER=${DB_USER:-root}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_HOST=${DB_HOST:-127.0.0.1}
      - DB_PORT=${DB_PORT:-3306}
      - DB_NAME=${DB_NAME:-aiqa}
      - OPENAI_API_KEYs=${OPENAI_API_KEYs}
      - OPENAI_API_URL=${OPENAI_API_URL:-https://api.openai.com/v1/chat/completions}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o}
      - OPENAI_EMBEDDING_MODEL=${OPENAI_EMBEDDING_MODEL:-text-embedding-3-large}
      - GENERIC_SYSTEM_PROMPT=${GENERIC_SYSTEM_PROMPT:-}
      - KB_SYSTEM_PROMPT=${KB_SYSTEM_PROMPT:-}
      - SERVER_PORT=:8080
    volumes:
      - ./uploads:/app/uploads
    networks:
      - anyqa_network

  frontend:
    image: ${FRONTEND_IMAGE}
    container_name: anyqa_frontend
    env_file:
      - .env
    ports:
      - "11451:80"
    restart: always
    depends_on:
      - backend
    networks:
      - anyqa_network
    volumes:
      - ./config/frontend/config.json:/usr/share/nginx/html/config.json:ro

networks:
  anyqa_network:
    driver: bridge
